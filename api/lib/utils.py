from api.lib.common import initilalized_logger
logger = initilalized_logger(__name__)
import boto3
import botocore
from boto3.dynamodb.conditions import Attr

exchange_url= "https://v6.exchangerate-api.com/v6/c85c4dd12f12fad95e00b0b2/latest/EUR"

sample_json_1 = {
          "result": "success",
          "documentation": "https://www.exchangerate-api.com/docs",
          "terms_of_use": "https://www.exchangerate-api.com/terms",
          "time_last_update_unix": 1673740801,
          "time_last_update_utc": "Sun, 15 Jan 2023 00:00:01 +0000",
          "time_next_update_unix": 1673827201,
          "time_next_update_utc": "Mon, 16 Jan 2023 00:00:01 +0000",
          "base_code": "EUR",
          "conversion_rates": {
            "EUR": 1,
            "AED": 3.9747,
            "AFN": 96.8134,
            "ALL": 116.5864,
            "AMD": 429.0356,
            "ANG": 1.9373,
            "AOA": 550.7604,
            "ARS": 194.6473,
            "AUD": 1.5556,
            "AWG": 1.9373,
            "AZN": 1.8366,
            "BAM": 1.9558,
            "BBD": 2.1646,
            "BDT": 113.0108,
            "BGN": 1.9558,
            "BHD": 0.4069,
            "BIF": 2226.101,
            "BMD": 1.0823,
            "BND": 1.4302,
            "BOB": 7.4618,
            "BRL": 5.5398,
            "BSD": 1.0823,
            "BTN": 88.0113,
            "BWP": 13.7091,
            "BYN": 2.7255,
            "BZD": 2.1646,
            "CAD": 1.4491,
            "CDF": 2224.4865,
            "CHF": 1.0034,
            "CLP": 887.5428,
            "CNY": 7.2686,
            "COP": 5076.9815,
            "CRC": 628.6229,
            "CUP": 25.9748,
            "CVE": 110.265,
            "CZK": 24.0111,
            "DJF": 192.3443,
            "DKK": 7.4604,
            "DOP": 60.8251,
            "DZD": 147.1247,
            "EGP": 32.0179,
            "ERN": 16.2342,
            "ETB": 57.8636,
            "FJD": 2.3512,
            "FKP": 0.886,
            "FOK": 7.4604,
            "GBP": 0.886,
            "GEL": 2.8939,
            "GGP": 0.886,
            "GHS": 13.6171,
            "GIP": 0.886,
            "GMD": 68.0074,
            "GNF": 9406.4,
            "GTQ": 8.4472,
            "GYD": 225.3415,
            "HKD": 8.4503,
            "HNL": 26.5643,
            "HRK": 7.5345,
            "HTG": 159.8951,
            "HUF": 396.5646,
            "IDR": 16381.8843,
            "ILS": 3.6913,
            "IMP": 0.886,
            "INR": 88.0115,
            "IQD": 1575.2344,
            "IRR": 45941.3003,
            "ISK": 154.3015,
            "JEP": 0.886,
            "JMD": 165.9272,
            "JOD": 0.7673,
            "JPY": 138.6526,
            "KES": 133.2993,
            "KGS": 92.5291,
            "KHR": 4448.973,
            "KID": 1.5556,
            "KMF": 491.9678,
            "KRW": 1342.1654,
            "KWD": 0.33,
            "KYD": 0.9019,
            "KZT": 500.2004,
            "LAK": 18318.7581,
            "LBP": 1631.5409,
            "LKR": 395.9739,
            "LRD": 166.6817,
            "LSL": 18.2295,
            "LYD": 5.1569,
            "MAD": 10.929,
            "MDL": 20.6788,
            "MGA": 4801.9553,
            "MKD": 61.695,
            "MMK": 2602.3663,
            "MNT": 3699.1461,
            "MOP": 8.7038,
            "MRU": 39.1887,
            "MUR": 47.1237,
            "MVR": 16.6341,
            "MWK": 1114.908,
            "MXN": 20.3544,
            "MYR": 4.7001,
            "MZN": 69.0115,
            "NAD": 18.2295,
            "NGN": 486.4901,
            "NIO": 39.31,
            "NOK": 10.6912,
            "NPR": 140.8181,
            "NZD": 1.6986,
            "OMR": 0.4161,
            "PAB": 1.0823,
            "PEN": 4.1146,
            "PGK": 3.7935,
            "PHP": 59.4704,
            "PKR": 246.1811,
            "PLN": 4.6927,
            "PYG": 7999.1183,
            "QAR": 3.9395,
            "RON": 4.9421,
            "RSD": 117.3867,
            "RUB": 74.0429,
            "RWF": 1191.106,
            "SAR": 4.0586,
            "SBD": 9.0547,
            "SCR": 14.1125,
            "SDG": 481.3216,
            "SEK": 11.2542,
            "SGD": 1.4293,
            "SHP": 0.886,
            "SLE": 21.1078,
            "SLL": 21107.6396,
            "SOS": 611.9405,
            "SRD": 34.1519,
            "SSP": 734.5152,
            "STN": 24.5,
            "SYP": 2701.3751,
            "SZL": 18.2295,
            "THB": 35.7555,
            "TJS": 11.1065,
            "TMT": 3.7912,
            "TND": 3.0879,
            "TOP": 2.5642,
            "TRY": 20.3404,
            "TTD": 7.5115,
            "TVD": 1.5556,
            "TWD": 32.7977,
            "TZS": 2521.0701,
            "UAH": 39.8112,
            "UGX": 3966.053,
            "USD": 1.0823,
            "UYU": 42.8862,
            "UZS": 12232.7608,
            "VES": 21.0696,
            "VND": 25209.2786,
            "VUV": 130.5298,
            "WST": 2.8894,
            "XAF": 655.957,
            "XCD": 2.9222,
            "XDR": 0.8014,
            "XOF": 655.957,
            "XPF": 119.332,
            "YER": 269.5528,
            "ZAR": 18.2295,
            "ZMW": 19.8328,
            "ZWL": 771.273
          }
        }

sample_json_2 = {
    "result": "success",
    "documentation": "https://www.exchangerate-api.com/docs",
    "terms_of_use": "https://www.exchangerate-api.com/terms",
    "time_last_update_unix": 1673827202,
    "time_last_update_utc": "Mon, 16 Jan 2023 00:00:02 +0000",
    "time_next_update_unix": 1673913602,
    "time_next_update_utc": "Tue, 17 Jan 2023 00:00:02 +0000",
    "base_code": "EUR",
    "conversion_rates": {
        "EUR": 1,
        "AED": 3.9740,
        "AFN": 97.2151,
        "ALL": 116.1952,
        "AMD": 429.3461,
        "ANG": 1.9370,
        "AOA": 552.4878,
        "ARS": 196.3040,
        "AUD": 1.5537,
        "AWG": 1.9370,
        "AZN": 1.8477,
        "BAM": 1.9558,
        "BBD": 2.1642,
        "BDT": 113.4943,
        "BGN": 1.9558,
        "BHD": 0.4069,
        "BIF": 2231.4486,
        "BMD": 1.0821,
        "BND": 1.4302,
        "BOB": 7.5027,
        "BRL": 5.5235,
        "BSD": 1.0821,
        "BTN": 87.9305,
        "BWP": 13.7527,
        "BYN": 2.7186,
        "BZD": 2.1642,
        "CAD": 1.4499,
        "CDF": 2174.5526,
        "CHF": 1.0032,
        "CLP": 887.0482,
        "CNY": 7.2699,
        "COP": 5083.5161,
        "CRC": 631.7143,
        "CUP": 25.9705,
        "CVE": 110.2650,
        "CZK": 24.0064,
        "DJF": 192.3124,
        "DKK": 7.4604,
        "DOP": 61.2106,
        "DZD": 147.9960,
        "EGP": 32.0432,
        "ERN": 16.2315,
        "ETB": 58.0755,
        "FJD": 2.3600,
        "FKP": 0.8858,
        "FOK": 7.4604,
        "GBP": 0.8858,
        "GEL": 2.8865,
        "GGP": 0.8858,
        "GHS": 13.1338,
        "GIP": 0.8858,
        "GMD": 67.1950,
        "GNF": 9181.4444,
        "GTQ": 8.5056,
        "GYD": 226.5469,
        "HKD": 8.4546,
        "HNL": 26.6180,
        "HRK": 7.5345,
        "HTG": 160.2968,
        "HUF": 396.0088,
        "IDR": 16435.9325,
        "ILS": 3.6917,
        "IMP": 0.8858,
        "INR": 87.9307,
        "IQD": 1581.4928,
        "IRR": 46955.7358,
        "ISK": 154.3015,
        "JEP": 0.8858,
        "JMD": 165.4709,
        "JOD": 0.7672,
        "JPY": 138.6397,
        "KES": 134.2435,
        "KGS": 92.7883,
        "KHR": 4466.6486,
        "KID": 1.5536,
        "KMF": 491.9678,
        "KRW": 1341.2762,
        "KWD": 0.3308,
        "KYD": 0.9018,
        "KZT": 501.2760,
        "LAK": 18308.3429,
        "LBP": 1631.2699,
        "LKR": 394.7839,
        "LRD": 167.7609,
        "LSL": 18.2282,
        "LYD": 5.1822,
        "MAD": 10.9250,
        "MDL": 20.6959,
        "MGA": 4790.1744,
        "MKD": 61.6950,
        "MMK": 2546.3044,
        "MNT": 3756.0455,
        "MOP": 8.7093,
        "MRU": 39.4006,
        "MUR": 47.0181,
        "MVR": 16.7319,
        "MWK": 1107.5276,
        "MXN": 20.3464,
        "MYR": 4.6952,
        "MZN": 69.1009,
        "NAD": 18.2282,
        "NGN": 490.3106,
        "NIO": 39.5008,
        "NOK": 10.6923,
        "NPR": 140.6887,
        "NZD": 1.6960,
        "OMR": 0.4161,
        "PAB": 1.0821,
        "PEN": 4.1150,
        "PGK": 3.8165,
        "PHP": 59.4595,
        "PKR": 247.9225,
        "PLN": 4.6924,
        "PYG": 8017.5890,
        "QAR": 3.9389,
        "RON": 4.9429,
        "RSD": 117.4212,
        "RUB": 72.7880,
        "RWF": 1170.2093,
        "SAR": 4.0579,
        "SBD": 9.0644,
        "SCR": 14.9829,
        "SDG": 483.9414,
        "SEK": 11.2309,
        "SGD": 1.4301,
        "SHP": 0.8858,
        "SLE": 21.1042,
        "SLL": 21100.7435,
        "SOS": 615.5158,
        "SRD": 34.4304,
        "SSP": 734.5152,
        "STN": 24.5000,
        "SYP": 2728.9634,
        "SZL": 18.2282,
        "THB": 35.7486,
        "TJS": 11.1065,
        "TMT": 3.7914,
        "TND": 3.3000,
        "TOP": 2.5561,
        "TRY": 20.3430,
        "TTD": 7.3891,
        "TVD": 1.5536,
        "TWD": 32.8142,
        "TZS": 2523.2861,
        "UAH": 39.8282,
        "UGX": 3979.7472,
        "USD": 1.0820,
        "UYU": 42.9425,
        "UZS": 12242.8060,
        "VES": 21.0696,
        "VND": 25420.4814,
        "VUV": 129.3876,
        "WST": 2.8878,
        "XAF": 655.9570,
        "XCD": 2.9217,
        "XDR": 0.8014,
        "XOF": 655.9570,
        "XPF": 119.3320,
        "YER": 271.2023,
        "ZAR": 18.2150,
        "ZMW": 19.9415,
        "ZWL": 771.2730
    }
}


def ddb_connection():
  dynamodb = boto3.resource('dynamodb')
  table = dynamodb.Table("ExchangeRates")
  return {
    "db": dynamodb,
    "table": table
  }


def ddb_check_current_date_exchange_rates(date):
    try:
        response = ddb_connection().get("table").get_item(
            Key={
              'date': date
            }
        )
        return response['Item']
    except Exception as e:
        raise e


def ddb_generic_put_table_item(data_item):
  """
  update any table with the passed data_item, the item must already have the
  required partition and sort keys set in the object that match the tables
  defined partition and sort_key named fields
  :param ddb_table_name:
  :param data_item: Object that is json serializable or dict
  :return: DynamoDB response
  """
  response = None
  try:
    # update DynamoDB rec then done
    table = ddb_connection().get("table")

    # creating new record
    if type(data_item) is not dict:
      response = table.put_item(Item=data_item.__dict__)
    else:
      response = table.put_item(Item=data_item)
    logger.info('Put DDB data item {0}'.format(data_item))

  except Exception as e:
    msg = 'ERROR updating DynamoDB rec: {0} - {1}'.format(
      data_item, e)
    logger.exception(msg)
  return response
